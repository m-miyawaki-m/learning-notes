SQLの分析関数（Analytic Functions）は、データを集計せずに複数の行にまたがる計算を実行するために使用されます。これらの関数は、データセット内の各行に対して個別の計算を行いながら、特定のウィンドウやパーティション内のデータを考慮します。これにより、ランキング、移動平均、累積集計などの複雑なデータ分析タスクを実行できます。

主な分析関数には以下のものがあります：

1. **ランキング関数**:
   - `ROW_NUMBER()`: 各行に一意の順序番号を割り当てます。
   - `RANK()`: 同じ値を持つ行に同じランクを割り当て、次のランクは「スキップ」されます。
   - `DENSE_RANK()`: `RANK()`と似ていますが、ランクの「スキップ」がありません。

2. **集計関数**:
   - `SUM()`, `AVG()`, `MIN()`, `MAX()`: ウィンドウ内の合計、平均、最小値、最大値などを計算します。

3. **ウィンドウ関数**:
   - `LEAD()`, `LAG()`: 指定された数の行先または後ろの値を取得します。
   - `FIRST_VALUE()`, `LAST_VALUE()`: ウィンドウ内の最初または最後の値を取得します。

これらの関数は、`OVER`句を使用して適用されます。`OVER`句は、関数が適用されるウィンドウまたはデータのセットを定義します。この句は、パーティション、順序、およびフレーム仕様を含むことができます。

例えば、従業員の給与データに対して、各従業員の給与が部門内でどのようなランキングになるかを調べる場合、次のようなクエリを使用できます：

```sql
SELECT 
  department_id, 
  employee_id, 
  salary,
  RANK() OVER (PARTITION BY department_id ORDER BY salary DESC) as salary_rank
FROM employees;
```

このクエリでは、`RANK()`関数が各部門（`department_id`でパーティション分け）の従業員に対して、給与（`salary`）の降順でランキングを行います。

分析関数は複雑なデータ処理に非常に強力ですが、その使用には適切なデータ理解とSQL知識が必要です。

文字数: 1482
トークン数: 216